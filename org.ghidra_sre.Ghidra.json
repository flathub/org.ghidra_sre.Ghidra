{
    "app-id": "org.ghidra_sre.Ghidra",
    "runtime": "org.freedesktop.Sdk",
    "runtime-version": "24.08",
    "sdk": "org.freedesktop.Sdk",
    "sdk-extensions": [
        "org.freedesktop.Sdk.Extension.openjdk21"
    ],
    "command": "ghidra",
    "finish-args": [
        "--share=network",
        "--share=ipc",
        "--socket=x11",
        "--socket=pulseaudio",
        "--device=dri",
        "--allow=devel",
        "--filesystem=home",
        "--env=PATH=/usr/bin:/app/bin:/app/jdk/bin",
        "--env=JAVA_HOME=/app/jdk"
    ],
    "modules": [
        {
            "name": "openjdk",
            "buildsystem": "simple",
            "build-commands": [
                "/usr/lib/sdk/openjdk21/installjdk.sh"
            ]
        },
        {
            "name": "icoutils",
            "cleanup": [
                "*"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download.savannah.gnu.org/releases/icoutils/icoutils-0.32.3.tar.bz2",
                    "sha256": "17abe02d043a253b68b47e3af69c9fc755b895db68fdc8811786125df564c6e0",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 1360,
                        "url-template": "https://download.savannah.gnu.org/releases/icoutils/icoutils-$version.tar.bz2"
                    }
                }
            ]
        },
        {
            "name": "ghidra",
            "buildsystem": "simple",
            "build-commands": [
                "cp dex2jar/lib/dex-*.jar dependencies/flatRepo",
                "cp ghidra-data/lib/*.jar dependencies/flatRepo",
                "mkdir -p dependencies/SymbolicSummaryZ3/os/linux_x86_64",
                "mkdir -p dependencies/SymbolicSummaryZ3/os/linux_arm64",
                "cp z3-x64/bin/libz3*.so dependencies/SymbolicSummaryZ3/os/linux_x86_64",
                "cp z3-arm64/bin/libz3*.so dependencies/SymbolicSummaryZ3/os/linux_arm64",
                "cp z3-x64/bin/com.microsoft.z3.jar dependencies/flatRepo",
                "cp -r ghidra-data/FunctionID dependencies/fidb",
                "sed -i 's/^application.release.name=DEV$/application.release.name=FLATPAK/' Ghidra/application.properties",
                "source /usr/lib/sdk/openjdk21/enable.sh && gradle buildGhidra",
                "unzip build/dist/ghidra_*_FLATPAK_*_linux_*.zip",
                "icotool -x Ghidra/RuntimeScripts/Windows/support/ghidra.ico --index=8",
                "cp -r ghidra_*_FLATPAK /app/lib/ghidra",
                "install -Dm644 ghidra_8_256x256x32.png /app/share/icons/hicolor/256x256/apps/${FLATPAK_ID}.png",
                "install -Dm644 org.ghidra_sre.Ghidra.desktop /app/share/applications/org.ghidra_sre.Ghidra.desktop",
                "install -Dm644 org.ghidra_sre.Ghidra.metainfo.xml /app/share/metainfo/org.ghidra_sre.Ghidra.metainfo.xml",
                "install -Dm755 ghidra.sh /app/bin/ghidra",
                "mv /app/lib/ghidra/support/launch.properties{,.orig}",
                "ln -s /var/config/ghidra.properties /app/lib/ghidra/support/launch.properties",
                "sed -i 's,bg,fg,' /app/lib/ghidra/ghidraRun"
            ],
            "sources": [
                {
                    "type": "git",
                    "tag": "Ghidra_12.0.3_build",
                    "url": "https://github.com/NationalSecurityAgency/ghidra.git",
                    "commit": "09f14c92d3da6e5d5f6b7dea115409719db3cce1",
                    "x-checker-data": {
                        "type": "json",
                        "is-main-source": true,
                        "url": "https://api.github.com/repos/NationalSecurityAgency/ghidra/releases/latest",
                        "tag-query": ".tag_name",
                        "version-query": ".tag_name | sub(\"^Ghidra_\"; \"\") | sub(\"_build$\"; \"\")",
                        "timestamp-query": ".published_at"
                    }
                },
                {
                    "type": "patch",
                    "path": "last_modified.patch"
                },
                {
                    "type": "patch",
                    "path": "remove-maven-repo.patch"
                },
                {
                    "type": "file",
                    "path": "org.ghidra_sre.Ghidra.desktop"
                },
                {
                    "type": "file",
                    "path": "org.ghidra_sre.Ghidra.metainfo.xml"
                },
                {
                    "type": "script",
                    "dest-filename": "ghidra.sh",
                    "commands": [
                        "# Create a default ghidra.properties if one wasn't already set, for the user to edit",
                        "[[ -f /var/config/ghidra.properties ]] || cp /app/lib/ghidra/support/launch.properties.orig /var/config/ghidra.properties",
                        "exec /app/lib/ghidra/ghidraRun \"$@\""
                    ]
                },
                {
                    "type": "archive",
                    "url": "https://github.com/pxb1988/dex2jar/releases/download/v2.1/dex2jar-2.1.zip",
                    "sha256": "7a9bdf843d43de4d1e94ec2e7b6f55825017b0c4a7ee39ff82660e2493a46f08",
                    "dest": "dex2jar"
                },
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/ee/01/1ed1d482960a5718fd99c82f6d79120181947cfd4667ec3944d448ed44a3/protobuf-6.31.0-py3-none-any.whl",
                    "sha256": "6ac2e82556e822c17a8d23aa1190bbc1d06efb9c261981da95c71c9da09e9e23",
                    "dest": "dependencies/Debugger-rmi-trace/"
                },
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/90/c7/6dc0a455d111f68ee43f27793971cf03fe29b6ef972042549db29eec39a2/psutil-5.9.8.tar.gz",
                    "sha256": "6be126e3225486dff286a8fb9a06246a5253f4c7c53b475ea5f5ac934e64194c",
                    "dest": "dependencies/Debugger-rmi-trace/"
                },
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/a3/dc/17031897dae0efacfea57dfd3a82fdd2a2aeb58e0ff71b77b87e44edc772/setuptools-80.9.0-py3-none-any.whl",
                    "sha256": "062d34222ad13e0cc312a4c02d73f059e86a4acbfbdea8f8f76b28c99f306922",
                    "dest": "dependencies/Debugger-rmi-trace/"
                },
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/0b/2c/87f3254fd8ffd29e4c02732eee68a83a1d3c346ae39bc6822dcbcb697f2b/wheel-0.45.1-py3-none-any.whl",
                    "sha256": "708e7481cc80179af0e556bbf0cc00b8444c7321e2700b8d8580231d13017248",
                    "dest": "dependencies/Debugger-rmi-trace/"
                },
                {
                    "type": "file",
                    "url": "https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/android4me/AXMLPrinter2.jar",
                    "sha256": "00ed038eb6abaf6ddec8d202a3ed7a81b521458f4cd459948115cfd02ff59d6d",
                    "dest": "dependencies/flatRepo"
                },
                {
                    "type": "file",
                    "url": "https://sourceforge.net/projects/yajsw/files/yajsw/yajsw-stable-13.18/yajsw-stable-13.18.zip",
                    "sha256": "50b34e9817c54b2970fa511ff4584f6556c179f69833aa8b9b1ff6485b61684f",
                    "dest": "dependencies/GhidraServer"
                },
                {
                    "type": "file",
                    "url": "https://archive.eclipse.org/tools/cdt/releases/8.6/cdt-8.6.0.zip",
                    "sha256": "81b7d19d57c4a3009f4761699a72e8d642b5e1d9251d2bb98df438b1e28f8ba9",
                    "dest": "dependencies/GhidraDev"
                },
                {
                    "type": "file",
                    "url": "https://sourceforge.net/projects/pydev/files/pydev/PyDev 6.3.1/PyDev 6.3.1.zip",
                    "sha256": "4d81fe9d8afe7665b8ea20844d3f5107f446742927c59973eade4f29809b0699",
                    "dest": "dependencies/GhidraDev",
                    "dest-filename": "PyDev 6.3.1.zip"
                },
                {
                    "type": "file",
                    "url": "https://github.com/NationalSecurityAgency/ghidra-data/raw/Ghidra_12.0/Debugger/dbgmodel.tlb",
                    "sha256": "8cf5f3a2eb81160aa349056a5ca4c2c726b1b6e98bf3097cd4135147163343c7",
                    "dest": "dependencies/Debugger-agent-dbgeng"
                },
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/ce/78/91db67e7fe1546dc8b02c38591b7732980373d2d252372f7358054031dd4/Pybag-2.2.12-py3-none-any.whl",
                    "sha256": "eda5ee6c4e873902981b7f525b42a02428b87c7368df2c5bdfe1ded0e6884126",
                    "dest": "dependencies/Debugger-agent-dbgeng"
                },
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/d0/dd/b28df50316ca193dd1275a4c47115a720796d9e1501c1888c4bfa5dc2260/capstone-5.0.1-py3-none-win_amd64.whl",
                    "sha256": "1bfa5c81e6880caf41a31946cd6d2d069c048bcc22edf121254b501a048de675",
                    "dest": "dependencies/Debugger-agent-dbgeng"
                },
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/50/8f/518a37381e55a8857a638afa86143efa5508434613541402d20611a1b322/comtypes-1.4.1-py3-none-any.whl",
                    "sha256": "a208a0e3ca1c0a5362735da0ff661822801dce87312b894d7d752add010a21b0",
                    "dest": "dependencies/Debugger-agent-dbgeng"
                },
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/83/1c/25b79fc3ec99b19b0a0730cc47356f7e2959863bf9f3cd314332bddb4f68/pywin32-306-cp312-cp312-win_amd64.whl",
                    "sha256": "37257794c1ad39ee9be652da0462dc2e394c8159dfd913a8a4e8eb6fd346da0e",
                    "dest": "dependencies/Debugger-agent-dbgeng"
                },
                {
                    "type": "archive",
                    "url": "https://github.com/Z3Prover/z3/releases/download/z3-4.13.0/z3-4.13.0-x64-glibc-2.31.zip",
                    "sha256": "bc31ad12446d7db1bd9d0ac82dec9d7b5129b8b8dd6e44b571a83ac6010d2f9b",
                    "dest": "z3-x64/"
                },
                {
                    "type": "archive",
                    "url": "https://github.com/Z3Prover/z3/releases/download/z3-4.15.4/z3-4.15.4-arm64-glibc-2.34.zip",
                    "sha256": "9e832578e28d9ed51a79b97948728a874854a3c38ee49e7aae05e7d6e0e93508",
                    "dest": "z3-arm64"
                },
                {
                    "type": "git",
                    "tag": "Ghidra_12.1",
                    "url": "https://github.com/NationalSecurityAgency/ghidra-data.git",
                    "commit": "da6c2ae8f8507ebdb6c92ec2e260db8bb6e50643",
                    "dest": "ghidra-data",
                    "x-checker-data": {
                        "type": "git",
                        "tag-pattern": "^Ghidra_([\\d.]+)$"
                    }
                },
                "gradle-dependencies.json"
            ]
        }
    ]
}
